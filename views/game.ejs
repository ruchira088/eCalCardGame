<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Game</title>
    <% include templates/header.ejs %>
    <% include templates/notifications.ejs %>
</head>
<body>
<div id="game" class="container">

    <span id="username" data-userName="<%= player.name %>"></span>

    <h1>Hi <%= player.name %></h1>

    <div id="playerHand">
        <% for(var i = 0; i < player.cards.length; i++)
        { var card = player.cards[i]; %>
        <img draggable="true" <%= Constants.CardValue %>="<%= card.getValue() %>" class="playingCard"
        src="<%= card.getPicture() %>">
        <% } %>
    </div>
    <input type="button" value="Declare Victory" onclick="declareVictory()">

    <div id="onlinePlayers">
        <h4>Players</h4>
        <ul>
            <% for(var i = 0; i < onlineUsers.length; i++) { %>
            <li id="<%= onlineUsers[i] %>" class="player"><%= onlineUsers[i] %></li>
            <% } %>
        </ul>
    </div>

    <div id="cardStack">
        <img id="cardDeck" class="playingCard" <%= Constants.CardSource %>="<%= Constants.CARD_SOURCE.DECK %>" onclick=
        "pickUpCard(this)"
             src="/images/deck/backOfCard.png">
        <span id="drawnCard"></span>
        <!--<span id="drawnCard"><img  draggable="true" class="playingCard" data-cardSource="drawnPile"-->
        <!--<%= Constants.CardValue %>="<%= drawnCards.showTopCard().getValue() %>"-->
        <!--src="<%= drawnCards.showTopCard().getPicture() %>"></span>-->
    </div>

    <div class="modal fade" id="winningCards" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Winning Cards</h4>
                </div>
                <div class="modal-body">
                </div>
                <div class="modal-footer">
                </div>
            </div>

        </div>
    </div>

</div>
<script>
    initWebSocket("<%= player.name %>");
    <% var topCard = drawnCards.showTopCard() %>
    createDrawnCard(new Card("<%= topCard.suit %>", "<%= topCard.number %>"));
    var playerCards = document.querySelectorAll("#playerHand img.playingCard");
    addEventListenersToCards(playerCards);
    highlightActivePlayer("<%= onlineUsers[0]%>");

    function changeCardValue(cardElement, value)
    {
        var cardValue = $(cardElement).attr("data-card-value");
        var cardImage = $(cardElement).attr("src");

        var imagePath = cardImage.substring(0, cardImage.indexOf(cardValue)) + value + ".png";

        $(cardElement).attr("data-card-value", value);
        $(cardElement).attr("src", imagePath);
    }

    $(document).ready(function()
    {
        $("#playerHand .playingCard").draggable(
                {
                    containment: "#playerHand"
                }
        ).droppable(
                {
                    drop: function(event, ui)
                    {
                        var sourceCard = event.toElement;
                        var cardValue = $(sourceCard).attr("data-card-value");

                        changeCardValue(this, cardValue);
                        $(sourceCard).remove();
                    },
                    over: function(event, ui)
                    {
                    },
                    out: function(event, ui)
                    {

                    },
                    accept: function(droppedElement)
                    {
                        var accept = false;

                        if($(droppedElement).parent()[0] == $("#cardStack")[0])
                        {
                            accept = true;
                        }

                        return accept;
                    }
                }
        );
    }
    );

</script>
</body>
</html>